import"../modulepreload-polyfill-B5Qt9EMX.js";/* empty css                */import{s,l as o,h as l,c as u}from"../sched-DruKi8Dd.js";function d(e){try{const t=e.match(/switcher=([^&]+)/);if(!t)return!1;const n=t[1],a=sessionStorage.getItem("app_transfer_token"),i=parseInt(sessionStorage.getItem("app_transfer_timestamp")||"0"),c=sessionStorage.getItem("app_transfer_source");return!a||a!==n?(o("out","Transfer token mismatch or missing"),!1):c!=="aceas"?(o("out","Invalid transfer source"),!1):Date.now()-i>3e4?(o("out","Transfer token expired"),!1):!0}catch(t){return console.error("Error validating transfer token:",t),!1}}async function r(){const e=await fetch("/ids/auth/refresh",{method:"POST",credentials:"include"});if(e.ok){const{access_token:t,refresh_token:n}=await e.json();return window.localStorage.setItem("access_token",t),window.localStorage.setItem("refresh_token",n),window.localStorage.setItem("is_authenticated","true"),!0}else return window.localStorage.removeItem("access_token"),window.localStorage.removeItem("refresh_token"),window.localStorage.setItem("is_authenticated","false"),!1}window.onload=async()=>{s();let e=!1;try{if(!await r()){o("out","State: not authenticated, please login"),window.location.hash.includes("switcher")?(d(window.location.hash)?o("out","Valid transfer token detected - redirecting to login"):o("out","Invalid or missing transfer token - login required"),location.href="/ids/auth/login"):e=!0;return}o("out","Authenticated."),sessionStorage.removeItem("app_transfer_token"),sessionStorage.removeItem("app_transfer_source"),sessionStorage.removeItem("app_transfer_timestamp");var t=setInterval(async()=>{if(!await r()){o("out","State: not authenticated, clearing interval"),clearInterval(t);return}},6e4);e=!0}catch(n){console.error(n),o("out","Init error: "+n)}finally{e&&l()}};document.getElementById("login").onclick=()=>{s(),location.href="/ids/auth/login"};document.getElementById("logout").onclick=()=>{s(),location.href="/ids/auth/logout"};document.getElementById("userinfo").onclick=async()=>{if(!(window.localStorage.getItem("is_authenticated")==="true"&&window.localStorage.getItem("access_token")))return o("out","Not logged in");const t=await fetch("/ids/me",{credentials:"include",headers:{Authorization:"Bearer "+window.localStorage.getItem("access_token")}});o("out","userinfo: "+JSON.stringify(await t.json(),null,2))};document.getElementById("callapi").onclick=async()=>{if(!(window.localStorage.getItem("is_authenticated")==="true"&&window.localStorage.getItem("access_token")))return o("out","Not logged in");const t=await u("/cpds/api/hello",window.localStorage.getItem("access_token"));o("out",`CPDS API [${t.status}]:
${t.body}`)};document.getElementById("switch").onclick=()=>{const e=crypto.randomUUID()+"-"+Date.now();sessionStorage.setItem("app_transfer_token",e),sessionStorage.setItem("app_transfer_source","cpds"),sessionStorage.setItem("app_transfer_timestamp",Date.now().toString()),window.location.href=`/aceas/#switcher=${e}`};
