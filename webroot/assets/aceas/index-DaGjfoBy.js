import"../modulepreload-polyfill-B5Qt9EMX.js";/* empty css                */import{l as h,c as ht,s as vt,h as dt}from"../sched-DruKi8Dd.js";import{o as d}from"../oidc-DAcC_2S7.js";var b,X;function pt(i){return i.children}b={__e:function(i,t,e,n){for(var o,r,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((r=o.constructor)&&r.getDerivedStateFromError!=null&&(o.setState(r.getDerivedStateFromError(i)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(i,n||{}),a=o.__d),a)return o.__E=o}catch(u){i=u}throw i}},X=function(i){return i!=null&&i.constructor==null},typeof Promise=="function"&&Promise.prototype.then.bind(Promise.resolve());var O,f,C,G,R=0,Y=[],_=b,j=_.__b,W=_.__r,J=_.diffed,Z=_.__c,z=_.unmount,M=_.__;function tt(i,t){_.__h&&_.__h(f,i,R||t),R=0;var e=f.__H||(f.__H={__:[],__h:[]});return i>=e.__.length&&e.__.push({}),e.__[i]}function yt(i){return R=1,mt(it,i)}function mt(i,t,e){var n=tt(O++,2);if(n.t=i,!n.__c&&(n.__=[it(void 0,t),function(u){var c=n.__N?n.__N[0]:n.__[0],l=n.t(c,u);c!==l&&(n.__N=[l,n.__[1]],n.__c.setState({}))}],n.__c=f,!f.__f)){var o=function(u,c,l){if(!n.__c.__H)return!0;var y=n.__c.__H.__.filter(function(p){return!!p.__c});if(y.every(function(p){return!p.__N}))return!r||r.call(this,u,c,l);var T=n.__c.props!==u;return y.forEach(function(p){if(p.__N){var g=p.__[0];p.__=p.__N,p.__N=void 0,g!==p.__[0]&&(T=!0)}}),r&&r.call(this,u,c,l)||T};f.__f=!0;var r=f.shouldComponentUpdate,a=f.componentWillUpdate;f.componentWillUpdate=function(u,c,l){if(this.__e){var y=r;r=void 0,o(u,c,l),r=y}a&&a.call(this,u,c,l)},f.shouldComponentUpdate=o}return n.__N||n.__}function wt(i,t){var e=tt(O++,7);return kt(e.__H,t)&&(e.__=i(),e.__H=t,e.__h=i),e.__}function gt(){for(var i;i=Y.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(I),i.__H.__h.forEach(V),i.__H.__h=[]}catch(t){i.__H.__h=[],_.__e(t,i.__v)}}_.__b=function(i){f=null,j&&j(i)},_.__=function(i,t){i&&t.__k&&t.__k.__m&&(i.__m=t.__k.__m),M&&M(i,t)},_.__r=function(i){W&&W(i),O=0;var t=(f=i.__c).__H;t&&(C===f?(t.__h=[],f.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0})):(t.__h.forEach(I),t.__h.forEach(V),t.__h=[],O=0)),C=f},_.diffed=function(i){J&&J(i);var t=i.__c;t&&t.__H&&(t.__H.__h.length&&(Y.push(t)!==1&&G===_.requestAnimationFrame||((G=_.requestAnimationFrame)||St)(gt)),t.__H.__.forEach(function(e){e.u&&(e.__H=e.u),e.u=void 0})),C=f=null},_.__c=function(i,t){t.some(function(e){try{e.__h.forEach(I),e.__h=e.__h.filter(function(n){return!n.__||V(n)})}catch(n){t.some(function(o){o.__h&&(o.__h=[])}),t=[],_.__e(n,e.__v)}}),Z&&Z(i,t)},_.unmount=function(i){z&&z(i);var t,e=i.__c;e&&e.__H&&(e.__H.__.forEach(function(n){try{I(n)}catch(o){t=o}}),e.__H=void 0,t&&_.__e(t,e.__v))};var K=typeof requestAnimationFrame=="function";function St(i){var t,e=function(){clearTimeout(n),K&&cancelAnimationFrame(t),setTimeout(i)},n=setTimeout(e,35);K&&(t=requestAnimationFrame(e))}function I(i){var t=f,e=i.__c;typeof e=="function"&&(i.__c=void 0,e()),f=t}function V(i){var t=f;i.__c=i.__(),f=t}function kt(i,t){return!i||i.length!==t.length||t.some(function(e,n){return e!==i[n]})}function it(i,t){return typeof t=="function"?t(i):t}var At=Symbol.for("preact-signals");function L(){if(w>1)w--;else{for(var i,t=!1;$!==void 0;){var e=$;for($=void 0,F++;e!==void 0;){var n=e.o;if(e.o=void 0,e.f&=-3,!(8&e.f)&&ot(e))try{e.c()}catch(o){t||(i=o,t=!0)}e=n}}if(F=0,w--,t)throw i}}function Et(i){if(w>0)return i();w++;try{return i()}finally{L()}}var s=void 0;function et(i){var t=s;s=void 0;try{return i()}finally{s=t}}var $=void 0,w=0,F=0,x=0;function nt(i){if(s!==void 0){var t=i.n;if(t===void 0||t.t!==s)return t={i:0,S:i,p:s.s,n:void 0,t:s,e:void 0,x:void 0,r:t},s.s!==void 0&&(s.s.n=t),s.s=t,i.n=t,32&s.f&&i.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=s.s,t.n=void 0,s.s.n=t,s.s=t),t}}function v(i,t){this.v=i,this.i=0,this.n=void 0,this.t=void 0,this.W=t?.watched,this.Z=t?.unwatched,this.name=t?.name}v.prototype.brand=At;v.prototype.h=function(){return!0};v.prototype.S=function(i){var t=this,e=this.t;e!==i&&i.e===void 0&&(i.x=e,this.t=i,e!==void 0?e.e=i:et(function(){var n;(n=t.W)==null||n.call(t)}))};v.prototype.U=function(i){var t=this;if(this.t!==void 0){var e=i.e,n=i.x;e!==void 0&&(e.x=n,i.e=void 0),n!==void 0&&(n.e=e,i.x=void 0),i===this.t&&(this.t=n,n===void 0&&et(function(){var o;(o=t.Z)==null||o.call(t)}))}};v.prototype.subscribe=function(i){var t=this;return k(function(){var e=t.value,n=s;s=void 0;try{i(e)}finally{s=n}},{name:"sub"})};v.prototype.valueOf=function(){return this.value};v.prototype.toString=function(){return this.value+""};v.prototype.toJSON=function(){return this.value};v.prototype.peek=function(){var i=s;s=void 0;try{return this.value}finally{s=i}};Object.defineProperty(v.prototype,"value",{get:function(){var i=nt(this);return i!==void 0&&(i.i=this.i),this.v},set:function(i){if(i!==this.v){if(F>100)throw new Error("Cycle detected");this.v=i,this.i++,x++,w++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{L()}}}});function N(i,t){return new v(i,t)}function ot(i){for(var t=i.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function rt(i){for(var t=i.s;t!==void 0;t=t.n){var e=t.S.n;if(e!==void 0&&(t.r=e),t.S.n=t,t.i=-1,t.n===void 0){i.s=t;break}}}function st(i){for(var t=i.s,e=void 0;t!==void 0;){var n=t.p;t.i===-1?(t.S.U(t),n!==void 0&&(n.n=t.n),t.n!==void 0&&(t.n.p=n)):e=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=n}i.s=e}function S(i,t){v.call(this,void 0),this.x=i,this.s=void 0,this.g=x-1,this.f=4,this.W=t?.watched,this.Z=t?.unwatched,this.name=t?.name}S.prototype=new v;S.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===x))return!0;if(this.g=x,this.f|=1,this.i>0&&!ot(this))return this.f&=-2,!0;var i=s;try{rt(this),s=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return s=i,st(this),this.f&=-2,!0};S.prototype.S=function(i){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}v.prototype.S.call(this,i)};S.prototype.U=function(i){if(this.t!==void 0&&(v.prototype.U.call(this,i),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};S.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;i!==void 0;i=i.x)i.t.N()}};Object.defineProperty(S.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var i=nt(this);if(this.h(),i!==void 0&&(i.i=this.i),16&this.f)throw this.v;return this.v}});function Q(i,t){return new S(i,t)}function at(i){var t=i.u;if(i.u=void 0,typeof t=="function"){w++;var e=s;s=void 0;try{t()}catch(n){throw i.f&=-2,i.f|=8,q(i),n}finally{s=e,L()}}}function q(i){for(var t=i.s;t!==void 0;t=t.n)t.S.U(t);i.x=void 0,i.s=void 0,at(i)}function $t(i){if(s!==this)throw new Error("Out-of-order effect");st(this),s=i,this.f&=-2,8&this.f&&q(this),L()}function A(i,t){this.x=i,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=t?.name}A.prototype.c=function(){var i=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{i()}};A.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,at(this),rt(this),w++;var i=s;return s=this,$t.bind(this,i)};A.prototype.N=function(){2&this.f||(this.f|=2,this.o=$,$=this)};A.prototype.d=function(){this.f|=8,1&this.f||q(this)};A.prototype.dispose=function(){this.d()};function k(i,t){var e=new A(i,t);try{e.c()}catch(o){throw e.d(),o}var n=e.d.bind(e);return n[Symbol.dispose]=n,n}var ut,H,ft=[];k(function(){ut=this.N})();function E(i,t){b[i]=t.bind(null,b[i]||function(){})}function U(i){H&&H(),H=i&&i.S()}function _t(i){var t=this,e=i.data,n=bt(e);n.value=e;var o=wt(function(){for(var u=t,c=t.__v;c=c.__;)if(c.__c){c.__c.__$f|=4;break}var l=Q(function(){var g=n.value.value;return g===0?0:g===!0?"":g||""}),y=Q(function(){return!Array.isArray(l.value)&&!X(l.value)}),T=k(function(){if(this.N=ct,y.value){var g=l.value;u.__v&&u.__v.__e&&u.__v.__e.nodeType===3&&(u.__v.__e.data=g)}}),p=t.__$u.d;return t.__$u.d=function(){T(),p.call(this)},[y,l]},[]),r=o[0],a=o[1];return r.value?a.peek():a.value}_t.displayName="ReactiveTextNode";Object.defineProperties(v.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:_t},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});E("__b",function(i,t){if(typeof t.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),typeof t.type=="string"){var e,n=t.props;for(var o in n)if(o!=="children"){var r=n[o];r instanceof v&&(e||(t.__np=e={}),e[o]=r,n[o]=r.peek())}}i(t)});E("__r",function(i,t){if(typeof t.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(t),t.type!==pt){U();var e,n=t.__c;n&&(n.__$f&=-2,(e=n.__$u)===void 0&&(n.__$u=e=(function(o){var r;return k(function(){r=this}),r.c=function(){n.__$f|=1,n.setState({})},r})())),U(e)}i(t)});E("__e",function(i,t,e,n){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),U(),i(t,e,n)});E("diffed",function(i,t){typeof t.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),U();var e;if(typeof t.type=="string"&&(e=t.__e)){var n=t.__np,o=t.props;if(n){var r=e.U;if(r)for(var a in r){var u=r[a];u!==void 0&&!(a in n)&&(u.d(),r[a]=void 0)}else r={},e.U=r;for(var c in n){var l=r[c],y=n[c];l===void 0?(l=Nt(e,c,y,o),r[c]=l):l.o(y,o)}}}i(t)});function Nt(i,t,e,n){var o=t in i&&i.ownerSVGElement===void 0,r=N(e);return{o:function(a,u){r.value=a,n=u},d:k(function(){this.N=ct;var a=r.value.value;n[t]!==a&&(n[t]=a,o?i[t]=a:a?i.setAttribute(t,a):i.removeAttribute(t))})}}E("unmount",function(i,t){if(typeof t.type=="string"){var e=t.__e;if(e){var n=e.U;if(n){e.U=void 0;for(var o in n){var r=n[o];r&&r.d()}}}}else{var a=t.__c;if(a){var u=a.__$u;u&&(a.__$u=void 0,u.d())}}i(t)});E("__h",function(i,t,e,n){(n<3||n===9)&&(t.__$f|=2),i(t,e,n)});function bt(i,t){return yt(function(){return N(i,t)})[0]}var Tt=function(i){queueMicrotask(function(){queueMicrotask(i)})};function It(){Et(function(){for(var i;i=ft.shift();)ut.call(i)})}function ct(){ft.push(this)===1&&(b.requestAnimationFrame||Tt)(It)}const lt=document.getElementById("login"),D=document.getElementById("logout"),P=document.getElementById("userinfo"),B=document.getElementById("callapi"),Ot=document.getElementById("switch"),m={isAuthenticated:N(!1),isLoading:N(!1),userInfo:N(null)};async function xt(i){try{const t=i.match(/switcher=([^&]+)/);if(!t)return!1;const e=t[1],n=sessionStorage.getItem("app_transfer_token"),o=parseInt(sessionStorage.getItem("app_transfer_timestamp")||"0"),r=sessionStorage.getItem("app_transfer_source");return!n||n!==e?(h("out","Transfer token mismatch or missing"),!1):r!=="cpds"?(h("out","Invalid transfer source"),!1):Date.now()-o>3e4?(h("out","Transfer token expired"),!1):!0}catch(t){return console.error("Error validating transfer token:",t),!1}}async function Ut(){const i=await d.getUser();if(i&&!i.expired)return h("out","Using cached user: "+JSON.stringify(i,null,2)),!0;try{const t=await d.signinSilent();return h("out","Silent signin success: "+JSON.stringify(t,null,2)),!!t&&!t.expired}catch{return!1}}async function Lt(){m.isLoading.value=!0;try{lt.onclick=()=>d.signinRedirect(),Ot.onclick=()=>{const t=crypto.randomUUID()+"-"+Date.now();sessionStorage.setItem("app_transfer_token",t),sessionStorage.setItem("app_transfer_source","aceas"),sessionStorage.setItem("app_transfer_timestamp",Date.now().toString()),window.location.href=`/cpds/#switcher=${t}`};const i=await Ut();if(m.isAuthenticated.value=i,i)h("out","Authenticated."),sessionStorage.removeItem("app_transfer_token"),sessionStorage.removeItem("app_transfer_source"),sessionStorage.removeItem("app_transfer_timestamp");else if(h("out","Not authenticated."),window.location.hash.includes("switcher")){xt(window.location.hash)||h("out","Invalid or missing transfer token - login required"),await d.signinRedirect();return}d.events.addAccessTokenExpiring(async()=>{try{await d.signinSilent(),h("out","token expiring → silent renew"),h("out","silent renew success")}catch(t){h("out","silent renew error: "+t)}}),d.events.addAccessTokenExpired(async()=>{try{await d.signinSilent(),h("out","token expired → silent renew")}catch(t){h("out","silent renew error: "+t),m.isAuthenticated.value=!1}}),d.events.addUserSignedOut(async()=>{await d.removeUser(),m.isAuthenticated.value=!1})}catch(i){console.error(i),h("out","Init error: "+i),m.isAuthenticated.value=!1}finally{m.isLoading.value=!1}}k(()=>{const i=m.isAuthenticated.value;lt.style.display=i?"none":"inline-block",D.style.display=i?"inline-block":"none",P.style.display=i?"inline-block":"none",B.style.display=i?"inline-block":"none",i&&(D.onclick||(D.onclick=async()=>{try{await d.signoutRedirect({post_logout_redirect_uri:`${window.location.origin}/aceas/`})}finally{await d.removeUser(),m.isAuthenticated.value=!1}}),P.onclick||(P.onclick=async()=>{const t=await d.getUser();if(!t)return h("out","Not logged in!");const n=await(await fetch("http://eservice.localhost/auth/realms/agency-realm/protocol/openid-connect/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}})).json();m.userInfo.value=n,h("out","userinfo: "+JSON.stringify(n,null,2))}),B.onclick||(B.onclick=async()=>{const t=await d.getUser();if(!t)return h("out","Login first");const e=await ht("/aceas/api/hello",t.access_token);h("out",`ACEAS API [${e.status}]:
${e.body}`)}))});k(()=>m.isLoading.value?vt():dt());Lt();
